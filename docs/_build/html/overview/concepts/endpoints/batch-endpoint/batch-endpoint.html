<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="ARM Templates" href="../../../../reference/templates.html" /><link rel="prev" title="Managed online endpoints" href="../online-endpoint/managed-online-endpoints.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Batch Endpoint (WIP) - azure.ml 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" href="../../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">azure.ml 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">azure.ml 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../setup.html">Cloud Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tooling.html">Tooling Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/jobs.html">Train Models (Create Jobs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/distributed-training.html">Distributed Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/endpoints.html">Deploy Models (WIP)</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../../concepts.html">Concepts</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../workspace.html">Manage Workspaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compute.html">Compute Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datastore.html">Manage Datastores (WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data.html">Manage Data Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../environment.html">Manage Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../quickstart/jobs.html">Train Models (Create Jobs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sweepjob.html">Hyperparameter tune (SweepJob)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../model.html">Manage Models</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../../endpoint.html">Manage Endpoints (WIP)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 has-children"><a class="reference internal" href="../online-endpoint/online-endpoint.html">Online Endpoints (WIP)</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../online-endpoint/scenarios.html">Deployment Scenarios</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../online-endpoint/scenarios/simple-deploy-flow.html">Simple deploy flow</a></li>
<li class="toctree-l5"><a class="reference internal" href="../online-endpoint/scenarios/declarative-flow.html">Declarative Canary Flow (aka Gitops flow)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../online-endpoint/scenarios/imperative-flow.html">Imperative Canary Flow</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../online-endpoint/managed-online-endpoints.html">Managed online endpoints</a></li>
</ul>
</li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Batch Endpoint (WIP)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/templates.html">ARM Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/feedback.html">Feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/qna.html">Q&amp;A</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/azure-ml.html">Azure-ML Reference</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="batch-endpoint-wip">
<h1>Batch Endpoint (WIP)<a class="headerlink" href="#batch-endpoint-wip" title="Permalink to this headline">¶</a></h1>
<p>Batch Endpoint is used to run batch scoring with a large data input.
Unlike online scoring (also known as realtime scoring) where you get the scoring result right away, batch scoring is executed asynchronously. That is, you trigger a batch scoring job through Batch Endpoint, wait till it is completed, and check later for the scoring results that are stored in your configured output location.</p>
<div class="section" id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<p>Batch scoring can’t be run locally, so you run them on cloud resources. Run the following command to create a CPU-enabled compute.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml compute create --name cpuCompute --type AmlCompute --min-instances <span class="m">0</span> --max-instances <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-batch-endpoint">
<h2>Create a Batch Endpoint<a class="headerlink" href="#create-a-batch-endpoint" title="Permalink to this headline">¶</a></h2>
<p>Create a batch endpoint for batch scoring.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint create --type batch --file examples/endpoints/batch/create-batch-endpoint.yml
</pre></div>
</div>
<p>No-code deployment is supported for MLflow model, that is environment and scoring script will be auto generated. Below is the yaml file.
To use a registered model, please replace the model section in yaml with <strong>model: azureml:&lt;modelName&gt;:&lt;modelVersion&gt;</strong>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mybatchendpoint</span>
<span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my sample batch endpoint</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">batch</span>
<span class="nt">auth_mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aad_token</span>
<span class="nt">traffic</span><span class="p">:</span>
  <span class="nt">autolog_deployment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>

<span class="nt">deployments</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">autolog_deployment</span>
    <span class="nt">model</span><span class="p">:</span> 
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">autolog</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">local_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./autolog_nyc_taxi</span>
    <span class="nt">mini_batch_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">output_configuration</span><span class="p">:</span>
      <span class="nt">output_action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">append_row</span>
      <span class="nt">append_row_file_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">predictions.csv</span>
    <span class="nt">retry_settings</span><span class="p">:</span>
      <span class="nt">max_retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
    <span class="nt">error_threshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span> 
    <span class="nt">logging_level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">info</span>
    <span class="nt">compute</span><span class="p">:</span>
      <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">azureml:cpuCompute</span>
      <span class="nt">instance_count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>   
</pre></div>
</div>
</div>
<div class="section" id="check-the-batch-endpoint-details">
<h2>Check the batch endpoint details<a class="headerlink" href="#check-the-batch-endpoint-details" title="Permalink to this headline">¶</a></h2>
<p>Check the details of the batch endpoint along with status.
You can use the <a class="reference external" href="https://docs.microsoft.com/en-us/cli/azure/query-azure-cli">–query parameter</a> to get only specific attributes from the returned data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint show --name mybatchendpoint --type batch
</pre></div>
</div>
</div>
<div class="section" id="start-a-batch-scoring-job">
<h2>Start a batch scoring job<a class="headerlink" href="#start-a-batch-scoring-job" title="Permalink to this headline">¶</a></h2>
<p>Start a batch scoring job by passing the input data. The input data can be a registered data, cloud path or local path. You will get a job name (a GUID) from the response.
You can also use REST API to start a batch scoring job, see the Appendix below.</p>
<p><strong>Note</strong>: During private preview, only FileDataset is supported.</p>
<div class="section" id="start-a-batch-scoring-job-with-different-input-options">
<h3>Start a batch scoring job with different input options<a class="headerlink" href="#start-a-batch-scoring-job-with-different-input-options" title="Permalink to this headline">¶</a></h3>
<p>Option 1: Input is registered data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-data azureml:&lt;datasetName&gt;:&lt;datasetVersion&gt;
</pre></div>
</div>
<p>Option 2: Input is cloud path.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-path https://pipelinedata.blob.core.windows.net/sampledata/nytaxi/taxi-tip-data.csv
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-datastore azureml:workspaceblobstore --input-path taxi-tip-data
</pre></div>
</div>
<p>Option 3: Input is local path.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-local-path &lt;local-data-path&gt;
</pre></div>
</div>
</div>
<div class="section" id="configure-output-location-when-start-a-batch-scoring-job">
<h3>Configure output location when start a batch scoring job<a class="headerlink" href="#configure-output-location-when-start-a-batch-scoring-job" title="Permalink to this headline">¶</a></h3>
<p>Scoring outputs are by default stored in a folder named job id (a GUID) in the workspace’s default store. You can configure the output path when invoking.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-path https://pipelinedata.blob.core.windows.net/sampledata/nytaxi/taxi-tip-data.csv --output-datastore azureml:workspaceblobstore --output-path mypath
</pre></div>
</div>
</div>
<div class="section" id="overwrite-settings-when-start-a-batch-scoring-job">
<h3>Overwrite settings when start a batch scoring job<a class="headerlink" href="#overwrite-settings-when-start-a-batch-scoring-job" title="Permalink to this headline">¶</a></h3>
<p>Some settings can be overwritten when start a batch scoring job.
Use <code class="docutils literal notranslate"><span class="pre">--mini-batch-size</span></code> to overwrite mini_batch_size if different size of input data is used.
Use <code class="docutils literal notranslate"><span class="pre">--instance-count</span></code> to overwrite instance_count if different compute resource is needed for this job.
Use <code class="docutils literal notranslate"><span class="pre">--set</span></code> to overwrite other settings including max_retries, timeout, error_threshold and logging_level.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-path https://pipelinedata.blob.core.windows.net/sampledata/nytaxi/taxi-tip-data.csv --set retry_settings.max_retries<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="check-batch-scoring-job-execution-progress">
<h2>Check batch scoring job execution progress<a class="headerlink" href="#check-batch-scoring-job-execution-progress" title="Permalink to this headline">¶</a></h2>
<p>Batch scoring job usually takes time to process the entire input. You can monitor the job progress from Azure portal. The portal link is provided in the response of invoke, check <cite>interactionEndpoints.studio</cite>.</p>
<p>You can also get the job link following below:</p>
<ol class="arabic simple">
<li><p>From your workspace page, click <cite>Studio web URL</cite> to launch studio.</p></li>
<li><p>Open <cite>Experiments</cite> page, and you will see a list of jobs.</p></li>
</ol>
<p>If you prefer using CLI, below are the commands.</p>
<p>Check job detail along with status.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml job show --name &lt;job-name&gt;
</pre></div>
</div>
<p>Stream job log.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml job stream --name &lt;job-name&gt;
</pre></div>
</div>
<p>Get the job name from the invoke response, or use below command to list all jobs. Add <code class="docutils literal notranslate"><span class="pre">--deployment</span></code> to get the job lists for a specific deployment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint list-jobs --name mybatchendpoint --type batch
</pre></div>
</div>
</div>
<div class="section" id="check-scoring-results">
<h2>Check scoring results<a class="headerlink" href="#check-scoring-results" title="Permalink to this headline">¶</a></h2>
<p>Follow below steps to view scoring results.</p>
<ol class="arabic simple">
<li><p>Go to the <cite>batchscoring</cite> step’s <cite>Outputs + logs</cite> tab, click <cite>Show data outputs</cite>, and click <cite>View output</cite> icon.</p></li>
<li><p>On the popup panel, copy the path and click <cite>Open Datastore</cite> link.</p></li>
<li><p>On the bloblstore page, paste above path in the search box. You will find the scoring output in the folder.</p></li>
</ol>
</div>
<div class="section" id="add-a-deployment-to-the-batch-endpoint">
<h2>Add a deployment to the batch endpoint<a class="headerlink" href="#add-a-deployment-to-the-batch-endpoint" title="Permalink to this headline">¶</a></h2>
<p>One batch endpoint can have multiple deployments hosting different models. Use the command below to add a new deployment to an existing batch endpoint.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint update --name mybatchendpoint --type batch --deployment-file examples/endpoints/batch/add-deployment.yml
</pre></div>
</div>
<p>This sample uses a non-MLFlow model, you will need to provide environment and scoring script.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mnist_deployment</span>
<span class="nt">model</span><span class="p">:</span> 
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mnist</span>
  <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">local_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./mnist/model/</span>
<span class="nt">code_configuration</span><span class="p">:</span>
  <span class="nt">code</span><span class="p">:</span>
    <span class="nt">local_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./mnist/code/</span>
  <span class="nt">scoring_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">digit_identification.py</span>
<span class="nt">environment</span><span class="p">:</span> 
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mnist-env</span>
  <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
  <span class="nt">conda_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">file:./mnist/environment/conda.yml</span>
  <span class="nt">docker</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mcr.microsoft.com/azureml/intelmpi2018.3-ubuntu16.04:20210301.v1</span>
<span class="nt">mini_batch_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="nt">output_configuration</span><span class="p">:</span>
  <span class="nt">output_action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">append_row</span>
  <span class="nt">append_row_file_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">predictions.csv</span>
<span class="nt">retry_settings</span><span class="p">:</span>
  <span class="nt">max_retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="nt">error_threshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span> 
<span class="nt">logging_level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">info</span>
<span class="nt">compute</span><span class="p">:</span>
  <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">azureml:cpuCompute</span>
  <span class="nt">instance_count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">environment_variables</span><span class="p">:</span>
  <span class="nt">AZUREML_BE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-env-var</span>
</pre></div>
</div>
</div>
<div class="section" id="activate-the-new-deployment">
<h2>Activate the new deployment<a class="headerlink" href="#activate-the-new-deployment" title="Permalink to this headline">¶</a></h2>
<p>When invoking an endpoint, the deployment with 100 traffic is in use. Use the command below to activate the new deployment by switching the traffic (can only be 0 or 100). Now you can invoke a batch scoring job with this new deployment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint update --name mybatchendpoint --type batch --traffic mnist_deployment:100
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">endpoint</span> <span class="pre">show</span></code> to check which deployment takes 100 traffic, or follow below steps to check in the UI.</p>
<ol class="arabic simple">
<li><p>In Azure Machine Learning studio, go to <cite>Endpoints</cite> page, click <cite>Pipeline endpoints</cite> tab.</p></li>
<li><p>Click the endpoint link, click <cite>Published pipelines</cite>.</p></li>
<li><p>The deployment with 100 traffic has a <cite>Default</cite> tag.</p></li>
</ol>
<p>Now you can trigger a batch scoring job using the new deployment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke --name mybatchendpoint --type batch --input-path https://pipelinedata.blob.core.windows.net/sampledata/mnist --mini-batch-size <span class="m">10</span> --instance-count <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="section" id="appendix-start-a-batch-scoring-job-using-rest-clients">
<h2>Appendix: start a batch scoring job using REST clients<a class="headerlink" href="#appendix-start-a-batch-scoring-job-using-rest-clients" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Get the scoring URI</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint show --name mybatchendpoint --type batch --query scoring_uri
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Get the azure ml access token</p></li>
</ol>
<p>Copy the value of the accessToken from the response.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az account get-access-token
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Use the scoring URI and the token in your REST client</p></li>
</ol>
<p>If you use Postman, then go to the Authorization tab in the request and paste the value of the token. Use the scoring uri from above as the URI for the <strong>POST</strong> request.</p>
<p>Option 1: Input is registered data.</p>
<p>Please provide the full ARMId. Replace with your own information following the sample below.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"properties"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"dataset"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"dataInputType"</span><span class="p">:</span> <span class="s2">"DatasetId"</span><span class="p">,</span>
            <span class="nt">"datasetId"</span><span class="p">:</span> <span class="s2">"/subscriptions/{{subscription}}/resourceGroups/{{resourcegroup}}/providers/Microsoft.MachineLearningServices/workspaces/{{workspaceName}}/data/{{datasetName}}/versions/1"</span>
            <span class="p">},</span>
        <span class="nt">"outputDataset"</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">"datastoreId"</span><span class="p">:</span> <span class="s2">"/subscriptions/{{subscriptionId}}/resourceGroups/{{resourceGroup}}/providers/Microsoft.MachineLearningServices/workspaces/{{workspaceName}}/datastores/{{datastorename}}"</span><span class="p">,</span>
          <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"mypath"</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Option 2: Input is cloud path.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"properties"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"dataset"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"dataInputType"</span><span class="p">:</span> <span class="s2">"DataUrl"</span><span class="p">,</span>
          <span class="nt">"Path"</span><span class="p">:</span> <span class="s2">"https://pipelinedata.blob.core.windows.net/sampledata/mnist"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../../../reference/templates.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">ARM Templates</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../online-endpoint/managed-online-endpoints.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Managed online endpoints</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020, Microsoft
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../../_sources/overview/concepts/endpoints/batch-endpoint/batch-endpoint.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Batch Endpoint (WIP)</a><ul>
<li><a class="reference internal" href="#prerequisite">Prerequisite</a></li>
<li><a class="reference internal" href="#create-a-batch-endpoint">Create a Batch Endpoint</a></li>
<li><a class="reference internal" href="#check-the-batch-endpoint-details">Check the batch endpoint details</a></li>
<li><a class="reference internal" href="#start-a-batch-scoring-job">Start a batch scoring job</a><ul>
<li><a class="reference internal" href="#start-a-batch-scoring-job-with-different-input-options">Start a batch scoring job with different input options</a></li>
<li><a class="reference internal" href="#configure-output-location-when-start-a-batch-scoring-job">Configure output location when start a batch scoring job</a></li>
<li><a class="reference internal" href="#overwrite-settings-when-start-a-batch-scoring-job">Overwrite settings when start a batch scoring job</a></li>
</ul>
</li>
<li><a class="reference internal" href="#check-batch-scoring-job-execution-progress">Check batch scoring job execution progress</a></li>
<li><a class="reference internal" href="#check-scoring-results">Check scoring results</a></li>
<li><a class="reference internal" href="#add-a-deployment-to-the-batch-endpoint">Add a deployment to the batch endpoint</a></li>
<li><a class="reference internal" href="#activate-the-new-deployment">Activate the new deployment</a></li>
<li><a class="reference internal" href="#appendix-start-a-batch-scoring-job-using-rest-clients">Appendix: start a batch scoring job using REST clients</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>